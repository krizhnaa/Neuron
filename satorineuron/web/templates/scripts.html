
<!--   Core JS Files   -->
<script src="{{ url_for('static', filename='js/core/popper.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/core/bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/plugins/perfect-scrollbar.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/plugins/smooth-scrollbar.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/plugins/chartjs.min.js') }}"></script>
<!-- Include Bootstrap JS for collapse functionality -->
<script src="{{ url_for('static', filename='js/plugins/jquery-3.5.1.slim.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/plugins/bootstrap.bundle.min.js') }}"></script>
<script>
  //var win = navigator.platform.indexOf('Win') > -1;
  //if (win && document.querySelector('#sidenav-scrollbar')) {
  //  var options = {
  //    damping: '0.5'
  //  }
  //  Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
  //  Scrollbar.init(document.querySelector('#ps__rail-y'), options);
  //}
  function scrollOrJumpToTop() {
    document.getElementById('top-navbar').scrollIntoView();
  }
  function scrollOrJumpTo(id) {
    document.getElementById(id).scrollIntoView();
  }
</script>
<!-- Github buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
<script src="{{ url_for('static', filename='js/material-dashboard.min.js') }}"></script>
<script>
  // Fullscreen
  function toggleFullScreen() {
    if ((document.fullScreenElement && document.fullScreenElement !== null) ||
      (!document.mozFullScreen && !document.webkitIsFullScreen)) {
      if (document.documentElement.requestFullScreen) {
        document.documentElement.requestFullScreen();
      } else if (document.documentElement.mozRequestFullScreen) {
        document.documentElement.mozRequestFullScreen();
      } else if (document.documentElement.webkitRequestFullScreen) {
        document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
      }
    } else {
      if (document.cancelFullScreen) {
        document.cancelFullScreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.webkitCancelFullScreen) {
        document.webkitCancelFullScreen();
      }
    }
  }
  document.addEventListener('DOMContentLoaded', (event) => {
    // Initialize button states from local storage on page load
    const votedProposals = JSON.parse(localStorage.getItem('votedProposals')) || {};

    // Function to highlight the buttons, disable them, and show the voted message if already voted
    function updateButtons(proposalId, vote) {
        // Reset button styles and enable state
        document.querySelectorAll(`#yes-btn-${proposalId}, #no-btn-${proposalId}`).forEach(btn => {
            btn.classList.remove('btn-selected');
            btn.disabled = false;
        });

        // Highlight the selected button and disable all buttons
        const selectedButton = vote === 'yes' ? document.getElementById('yes-btn-' + proposalId) : document.getElementById('no-btn-' + proposalId);
        if (selectedButton) {
            selectedButton.classList.add('btn-selected');
        }

        // Disable both buttons after a vote
        document.getElementById('yes-btn-' + proposalId).disabled = true;
        document.getElementById('no-btn-' + proposalId).disabled = true;

        // Show the voted message
        document.getElementById('voted-message-' + proposalId).style.display = 'inline';
    }

    // Apply button highlights and messages based on stored votes
    for (const proposalId in votedProposals) {
        if (votedProposals.hasOwnProperty(proposalId)) {
            updateButtons(proposalId, votedProposals[proposalId]);
        }
    }

    // Function to handle voting
    window.submitVote = function(proposalId, vote) {
        // Ensure the user hasn't already voted
        if (votedProposals[proposalId]) {
            return; // Exit if already voted
        }

        fetch('/proposals', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                proposal_id: proposalId,
                vote: vote
            }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Update the UI with the new vote count
                document.getElementById('yes-votes-' + proposalId).innerText = data.proposal.yes_votes;
                document.getElementById('no-votes-' + proposalId).innerText = data.proposal.no_votes;

                // Update and store the vote
                votedProposals[proposalId] = vote;
                localStorage.setItem('votedProposals', JSON.stringify(votedProposals));
                
                // Update button styles, disable buttons, and show the voted message
                updateButtons(proposalId, vote);
            }
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
});
</script>